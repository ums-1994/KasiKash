{% extends "base.html" %}

{% block title %}Stokvels - KasiKash{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css?family=Inter:400,600|Montserrat:700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}?v=4">
<link rel="stylesheet" href="{{ url_for('static', filename='css/stokvels.css') }}?v=1">
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Banner/Header -->
    <div class="stokvels-banner">
      <div style="flex:1;">
        <h1>My Stokvels <span style="font-size:1.8rem;">ü§ù</span></h1>
        <p>Manage and view your stokvel groups below.</p>
      </div>
      <button onclick="document.getElementById('createStokvelModal').classList.remove('hidden')" class="dashboard-btn inline-flex items-center mt-4 sm:mt-0">
        <i class="fas fa-plus-circle mr-2"></i> Create New Stokvel
      </button>
    </div>
    <div class="dashboard-grid mb-10">
        {% for stokvel in stokvels %}
        <div class="stokvel-card p-5 flex flex-col justify-between">
            <div>
                <div class="flex items-center gap-4 mb-3">
                    <h2 class="text-2xl font-bold accent">{{ stokvel.name }}</h2>
                    <span class="stokvel-role {% if stokvel.role == 'admin' %}bg-[#60efff] text-[#101c2c]{% else %}bg-[#22304a] text-[#60efff]{% endif %} text-sm px-4 py-2 rounded-full font-bold uppercase tracking-wide ml-3">{{ stokvel.role|title }}</span>
                </div>
                <p class="text-[#b2f7ef] text-base mb-4">{{ stokvel.description }}</p>
            </div>
            <div class="grid grid-cols-2 gap-x-8 gap-y-2 text-base text-[#b2f7ef] mb-4">
                <div class="flex flex-col"><span class="font-semibold text-[#60efff]">Monthly</span><span>R{{ stokvel.monthly_contribution }}</span></div>
                <div class="flex flex-col"><span class="font-semibold text-[#60efff]">Total Pool</span><span>R{{ stokvel.total_pool }}</span></div>
                <div class="flex flex-col"><span class="font-semibold text-[#60efff]">Target</span><span>R{{ stokvel.target_amount }}</span></div>
                <div class="flex flex-col"><span class="font-semibold text-[#60efff]">Target Date</span><span>{{ stokvel.target_date.strftime('%Y-%m-%d') if stokvel.target_date else 'Not set' }}</span></div>
            </div>
            <div class="mt-4 flex gap-4 items-stretch min-w-0">
                <a href="/contributions?stokvel_id={{ stokvel.id }}" class="stokvels-btn flex-1 min-w-0 h-full flex items-center justify-center text-lg px-6 py-3 text-center"><i class="fas fa-file-invoice-dollar"></i>Contributions</a>
                <a href="/stokvel/{{ stokvel.id }}/members" class="stokvels-btn flex-1 min-w-0 h-full flex items-center justify-center text-lg px-6 py-3 text-center"><i class="fas fa-users"></i>Members</a>
                {% if stokvel.role == 'admin' %}
                <form action="{{ url_for('delete_stokvel', stokvel_id=stokvel.id) }}" method="POST" class="flex-1 min-w-0 h-full flex items-stretch justify-center m-0 p-0" style="display: flex;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    <button type="submit" onclick="return confirm('Are you sure you want to delete this stokvel? This action cannot be undone.')" class="stokvels-btn stokvels-btn--danger w-full h-full flex items-center justify-center text-lg px-6 py-3 text-center"><i class="fas fa-trash"></i>Delete</button>
                </form>
                {% else %}
                <span class="flex-1 min-w-0 h-full" style="visibility:hidden;display:block;"></span>
                {% endif %}
            </div>
        </div>
        {% else %}
        <div class="glass-card text-center col-span-full">
            <i class="fas fa-users text-4xl text-gray-400 mb-3"></i>
            <p class="text-gray-400">You have not created or joined any stokvels yet.</p>
        </div>
        {% endfor %}
    </div>
    <!-- Create Stokvel Modal -->
    <div id="createStokvelModal" class="hidden modal-backdrop" style="background-color: rgba(10, 10, 20, 0.8); backdrop-filter: blur(8px);">
        <div class="glass-card w-full max-w-md m-4">
            <form action="{{ url_for('create_stokvel') }}" method="POST" class="flex flex-col">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <h3 class="text-2xl font-semibold accent mb-6">Create New Stokvel</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-400 text-sm font-bold mb-2" for="name">Stokvel Name</label>
                        <input type="text" name="name" id="name" required class="form-input" placeholder="e.g., Kasi Savings Group">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm font-bold mb-2" for="description">Description</label>
                        <textarea name="description" id="description" rows="3" class="form-input" placeholder="Describe your stokvel..."></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm font-bold mb-2" for="monthly_contribution">Monthly Contribution (R)</label>
                        <input type="number" name="monthly_contribution" id="monthly_contribution" required min="0" step="0.01" class="form-input" placeholder="e.g., 500">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm font-bold mb-2" for="target_amount">Target Amount (R)</label>
                        <input type="number" name="target_amount" id="target_amount" required min="0" step="0.01" class="form-input" placeholder="e.g., 10000">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm font-bold mb-2" for="target_date">Target Date</label>
                        <input type="date" name="target_date" id="target_date" required class="form-input">
                    </div>
                </div>
                <div class="flex justify-end space-x-4 mt-8">
                    <button type="button" onclick="document.getElementById('createStokvelModal').classList.add('hidden')" class="btn dashboard-btn" style="background:rgba(255,255,255,0.1);color:#60efff;">Cancel</button>
                    <button type="submit" class="dashboard-btn">Create</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.modal-backdrop').forEach(modal => {
            modal.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.classList.add('hidden');
                }
            });
        });
        document.addEventListener('keydown', (event) => {
            if (event.key === "Escape") {
                document.querySelectorAll('.modal-backdrop').forEach(modal => {
                    if (!modal.classList.contains('hidden')) {
                        modal.classList.add('hidden');
                    }
                });
            }
        });
    });
</script>
{% endblock %} 