<div id="chatbot-container" role="dialog" aria-label="KasiKash Assistant Chatbot">
    <section id="chatbot-main">
        <header id="chatbot-header">
            <div class="assistant-info">
                <div class="avatar" aria-hidden="true">ðŸ’¬</div>
                <div class="assistant-meta">
                    <span class="assistant-name">KasiKash Assistant</span>
                    <span class="status">Online â€¢ Financial Expert</span>
                </div>
            </div>
            <nav class="chat-controls" aria-label="Chatbot controls">
                <button id="chatbot-history" title="History" aria-label="Chat History"><i class="fas fa-history"></i></button>
                <button id="chatbot-close" title="Close" aria-label="Close Chatbot"><i class="fas fa-times"></i></button>
            </nav>
        </header>
        <div class="chatbot-mode-switch flex items-center justify-center my-2">
            <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="ai-mode-toggle" class="sr-only peer" aria-label="Toggle AI Mode">
                <div class="w-16 h-8 bg-gray-300 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-cyan-400 rounded-full peer dark:bg-gray-700 transition-all duration-300"></div>
                <div class="absolute left-0.5 top-0.5 w-7 h-7 bg-white border border-gray-200 rounded-full shadow-md transition-all duration-300 peer-checked:translate-x-8 flex items-center justify-center">
                    <span id="switch-icon" class="text-cyan-500 text-lg transition-all duration-300">ðŸ¤–</span>
                </div>
                <span class="ml-4 text-sm font-semibold text-cyan-200 peer-checked:text-green-400 transition-colors duration-300" id="mode-label">AI Mode</span>
            </label>
        </div>
        <div class="chatbot-divider" aria-hidden="true"></div>
        <main id="chatbot-messages" aria-live="polite" tabindex="0">
            <!-- Example message bubbles for layout preview. Remove these in production. -->
            <div class="message bot-message">
                <div class="message-content">
                    Hi there! I'm your KasiKash financial assistant. How can I help you today?
                </div>
            </div>
            <div class="message user-message">
                <div class="message-content">
                    How do I add members to my stokvel?
                </div>
            </div>
            <div class="message bot-message">
                <div class="message-content">
                    To add members, go to your stokvel page and click "Invite Members". You can send invites via email or share a join link.
                </div>
            </div>
            <!-- End example bubbles -->
        </main>
        <footer id="chatbot-input-area">
            <form id="chatbot-input" autocomplete="off" onsubmit="return false;">
                <button id="quick-tips" title="Quick Tips" aria-label="Show Quick Tips" type="button"><i class="fas fa-lightbulb"></i></button>
                <div class="input-send-wrapper">
                    <input type="text" id="user-message" placeholder="Type your message..." aria-label="Type your message" autocomplete="off">
                    <button id="send-message" aria-label="Send Message" type="submit"><i class="fas fa-paper-plane"></i></button>
                </div>
                <aside id="quick-tips-menu" class="hidden" aria-label="Quick Tips">
                    <div class="tip-header">Common Questions</div>
                    <div class="tip" data-question="How do I create a new stokvel?">Create a stokvel</div>
                    <div class="tip" data-question="How to add payment method?">Add payment method</div>
                    <div class="tip" data-question="Calculate savings goal: R500/month to R5000">Savings calculator</div>
                    <div class="tip" data-question="Explain stokvel payout rules">Payout rules</div>
                </aside>
            </form>
        </footer>
    </section>
    <button id="chatbot-fab" title="Open Chat" aria-label="Open Chatbot">ðŸ’¬</button>
</div>
<script>
// Improved FAB visibility logic
(function() {
    function updateFabVisibility() {
        var fab = document.getElementById('chatbot-fab');
        var container = document.getElementById('chatbot-container');
        
        // Show FAB when chatbot is minimized or on mobile
        if (container.classList.contains('minimized') || window.innerWidth <= 768) {
            fab.style.display = 'flex';
            fab.style.visibility = 'visible';
            fab.style.opacity = '1';
        } else {
            fab.style.display = 'none';
        }
    }
    
    // Update on load, resize, and when chatbot state changes
    window.addEventListener('resize', updateFabVisibility);
    document.addEventListener('DOMContentLoaded', updateFabVisibility);
    
    // Observe chatbot container for class changes
    const observer = new MutationObserver(updateFabVisibility);
    const container = document.getElementById('chatbot-container');
    if (container) {
        observer.observe(container, { attributes: true, attributeFilter: ['class'] });
    }
})();
</script>
<style>
#chatbot-input-area {
    position: sticky;
    bottom: 0;
    background: #f5f7fa;
    z-index: 2;
    box-shadow: 0 -2px 8px rgba(60, 60, 90, 0.04);
}

.chatbot-divider {
    height: 1px;
    background: #e3e6ee;
    margin: 0 0 0 0;
    width: 100%;
}
</style> 